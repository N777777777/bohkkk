{
  "rules": {
    // ⚠️ تنبيه: هذه القواعد تفترض أن جميع العمليات الحساسة (مثل زيادة الرصيد، سحب الأموال)
    // تتم عبر خادم خلفي آمن (مثل Firebase Cloud Functions) وليس مباشرة من العميل.
    // يجب أن يتم التحقق من هوية المستخدم (auth != null) في جميع القواعد.
    
    "users": {
      "$userId": {
        // يمكن للمستخدم قراءة بياناته الخاصة فقط
        ".read": "auth != null && auth.uid === $userId",
        // يمكن للمستخدم تحديث بياناته غير الحساسة فقط (مثل الاسم والصورة)
        ".write": "auth != null && auth.uid === $userId",
        
        // منع الكتابة المباشرة على الرصيد أو الإحصائيات الحساسة من العميل
        "balance": { ".write": false },
        "totalEarned": { ".write": false },
        "referrals": { ".write": false },
        "dailyAdCount": { ".write": false },
        "lifetimeAdCount": { ".write": false },
        "breakUntil": { ".write": false },
        "completedTasks": { ".write": false },
        "referredBy": { ".write": false },
        
        // السماح للمستخدم بتحديث حالته (مثل "welcomed") بعد التحقق من صحة البيانات
        "welcomed": {
          ".write": "auth != null && auth.uid === $userId && newData.isBoolean()"
        },
        
        // السماح للمستخدم بتحديث بياناته الشخصية (لنفترض أنها غير حساسة)
        "firstName": { ".write": "auth != null && auth.uid === $userId" },
        "lastName": { ".write": "auth != null && auth.uid === $userId" },
        "username": { ".write": "auth != null && auth.uid === $userId" },
        "photoUrl": { ".write": "auth != null && auth.uid === $userId" }
      }
    },
    
    "userEarnings": {
      // منع الكتابة المباشرة على سجلات الأرباح من العميل
      ".write": false,
      // السماح للمستخدم بقراءة سجلات أرباحه الخاصة فقط
      "$userId": {
        ".read": "auth != null && auth.uid === $userId"
      }
    },
    
    "withdrawals": {
      // منع الكتابة المباشرة على طلبات السحب من العميل
      ".write": false,
      // السماح للمستخدم بقراءة طلبات السحب الخاصة به فقط
      ".read": "auth != null && query.orderByChild === 'userId' && query.equalTo === auth.uid",
      
      // إذا كان هناك حاجة لإنشاء طلب سحب من العميل، يجب أن يتم ذلك عبر Cloud Function
      // أو بقاعدة صارمة جداً تضمن أن البيانات صحيحة وأن الرصيد تم خصمه مسبقاً من الخادم.
      // كمثال، إذا كان العميل يرسل طلب سحب إلى مسار مؤقت:
      "requests": {
        ".write": "auth != null && auth.uid === newData.child('userId').val() && newData.child('status').val() === 'pending'",
        ".validate": "newData.hasChildren(['userId', 'amount', 'account', 'status', 'timestamp']) && newData.child('amount').val() >= 0.05"
      }
    },
    
    "usedCodesz": {
      // منع الكتابة المباشرة على سجلات الأكواد المستخدمة من العميل
      ".write": false,
      // السماح بالقراءة فقط إذا كان المستخدم هو المالك
      "$userId": {
        ".read": "auth != null && auth.uid === $userId"
      }
    },
    
    "config": {
      // السماح بقراءة الإعدادات العامة للجميع
      ".read": true,
      // منع الكتابة على الإعدادات العامة من العميل
      ".write": false
    },
    
    // منع الوصول إلى أي مسارات أخرى بشكل افتراضي
    ".read": false,
    ".write": false
  }
}
